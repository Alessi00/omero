<template>
    <hr style="float: left;" />
    <div style="min-width: 110px;">
        <span class="collapsible-regions-header">Shape List</span>
        <div click.delegate="toggleRegionsTable()"
            class="regions-list-toggler collapse-up"
            style="margin-right: 5px;">
        </div>
    </div>
    <hr style="float: left;"/>
    <div class="row regions-list">
        <table class="regions-header">
            <thead>
                <tr>
                    <th id="reg-col-0" class="roi-toggle"><div>&nbsp;</div></th>
                    <th id="reg-col-1" class="roi-id"><div>ROI</div></th>
                    <th id="reg-col-2" class="shape-id"><div>Shape</div></th>
                    <th id="reg-col-3" class="shape-z"><div>Z</div></th>
                    <th id="reg-col-4" class="shape-t"><div>T</div></th>
                    <th id="reg-col-5" class="shape-type"><div>Type</div></th>
                    <th id="reg-col-6" class="shape-comment"><div>Comment</div></th>
                    <th id="reg-col-7" class="shape-show"><div>Show</div></th>
                </tr>
            </thead>
        </table>
        <table class="regions-table">
            <tbody>
                <template repeat.for="[roi_id, roi] of regions_info.data">
                    <template repeat.for="[shape_id, shape] of roi.shapes">
                        <tr show.bind="(roi.shapes.size - roi.deleted) > 1 &&
                                       roi.shapes.size > 1 && $first"
                            click.delegate="selectShapes(roi_id, $event)">
                            <td class="roi-toggle">
                                <div title="Click to show/hide shapes"
                                     style="cursor: pointer"
                                     click.delegate="expandOrCollapseRoi(roi_id, $event)">
                                     ${roi.show ? '&#9660;' : '&#9658;'}
                                 </div>
                             </td>
                            <td class="roi-id"><div>${roi_id}</div></td>
                            <td class="shape-id"><div>&nbsp;</div></td>
                            <td class="shape-z"></td>
                            <td class="shape-t"></td>
                            <td class="shape-type">
                                <div>(${(roi.shapes.size - roi.deleted)})</div>
                            </td>
                            <td class="shape-show"></td>
                        </tr>
                        <tr show.bind="!(shape.deleted && shape.is_new) &&
                                       !(roi.shapes.size > 1 && !roi.show)"
                            id="${'roi-' + shape.shape_id}"
                            css="${shape.selected ? 'background-color: #d0d0ff;' : ''}
                                 ${shape.deleted ? 'color: red;' :
                                    (shape.modified ? 'color: blue;' : '')}"
                            click.delegate="selectShape(shape.shape_id, shape.selected, $event)">
                            <td class="roi-toggle"><div>&nbsp;</div></td>
                            <td class="roi-id">
                                <div>
                                    ${roi.shapes.size &lt;= 1 ||
                                        (roi.shapes.size - roi.deleted) &lt;= 1 ?
                                        roi_id : '&nbsp;'}
                                </div>
                            </td>
                            <td class="shape-id"><div>${shape_id}</div></td>
                            <td class="shape-z"><div>
                                ${shape.TheZ !== -1 ? (shape.TheZ + 1) : ""}</div></td>
                            <td class="shape-t"><div>
                                ${shape.TheT !== -1 ? (shape.TheT + 1) : ""}</div></td>
                            <td class="shape-type ${shape.type.toLowerCase()}-icon">
                                <div>&nbsp;</div>
                            </td>
                            <td class="shape-comment">
                                <div>
                                    ${shape.Text ? shape.Text : '&nbsp;'}
                                </div>
                            </td>
                            <td class="shape-show">
                                <input type="checkbox" checked.bind="shape.visible"
                                    change.delegate="toggleShapeVisibility(shape.shape_id, shape.visible, $event)"/>
                            </td>
                        </tr>
                    </template>
                </template>
            </tbody>
        </table>
    </div>
</template>
